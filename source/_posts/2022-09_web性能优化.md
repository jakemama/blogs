---
title: web性能优化
tags:
  - 笔记
categories:
  - 前端
date: 2022-09-23 11:40:07
---
文章主题来自[趣谈前端文章](https://mp.weixin.qq.com/s?__biz=MzU2Mzk1NzkwOA==&mid=2247493508&idx=1&sn=78ea5442c66230945de101c64285805a&chksm=fc50fe7fcb277769883254d78ecafc1ef9ce7509c5e8b795cffc1ee406e495eaeb1246fd6a1d&scene=21#wechat_redirect)

<!--more-->
# 一、优化加载性能
多数浏览器使用单一进程来处理用户界面和js脚本执行，所以同一时刻只能做一件事。js执行过程耗时越久，浏览器等待响应的时间越长。
1. IE8,FF,3.5,Safari 4和Chrome都允许并行下载js文件，当script下载资源时不会阻塞其他script的下载。但是js下载仍然会阻塞其他资源的下载，如图片。尽管脚本下载不会互相影响，但页面仍然必须等待所有js代码下载并执行完才能继续。因此仍然存在**脚本阻塞问题.推荐将所有js文件放在body标签底部以减少对整个页面的影响。**
2. **减少页面外链脚本文件的数量将会提高页面性能**：http请求会带来额外的开销，因此下载单个300k的文件将比下载10个30k的文件效率更高。
3.** 动态脚本加载技术**：无论何时启动下载，文件的下载和执行都不会阻塞页面其他进程。写个load函数，动态创建script标签。或者使用一些无阻塞加载类库——LABjs

# 二、数据存取与JS性能

1. 数据存储共有4种方式：字面量，变量，数组项，对象成员。访问层级越深的属性越慢。

2. 可以把需要多次使用的对象成员，数组元素，跨域变量保存在局部变量中来改善js性能

# 三、DOM编程
1. 访问DOM会影响浏览器性能，修改DOM则更耗费性能，因为他会导致浏览器重新计算页面的几何变化。**通常的做法是减少访问DOM的次数，把运算尽量留在JS这一端。**在一个对性能要求比较高的操作中更新一段HTML，推荐使用innerHTML，因为它在绝大多数浏览器中运行的都很快。
2. HTML集合优化：HTML集合包含了DOM节点引用的类数组对象，一直与文档保持连接，每次你需要最新的信息时，都会重复执行查询操作，哪怕只是获取集合里元素的个数。**建议使用局部变量保存访问。需要频繁访问操作的话，建议将HTML转换成数组形式使用**
3. 遍历DOM：
   1. 使用只返回元素节点的API遍历DOM,因为这些API的执行效率比自己实现的效率更高：![](../images/web性能优化1.png)
   2. 选择器API——querySelectorAll()：querySelectorAll()方法使用css选择器作为参数并返回一个NodeList——包含着匹配节点的类数组对象，该方法不会返回HTML集合，因此返回的节点不会对应实时文档结构，着也避免了HTML集合引起的性能问题。
4. 重排和重绘：添加或删除可见的DOM、元素位置变化、元素尺寸改变、内容改变、页面渲染器初始化、浏览器窗口尺寸变化、出现滚动条时会触发整个页面的重排。重排必定重绘
5. 渲染树变化的排列和刷新：大多数浏览器通过队列化修改并批量执行来优化重排过程，然而获取布局信息的操作会导致队列强制刷新。例如
   1. offsetTop,offsetWidth...
   2. scrollTop,scrollHeight...
   3. clientTop,clientHeight...
   4. getComputedStyle()）
   5. **建议：将设置样式的操作和获取样式的操作分开：**
6. 最小化重绘和重排
   1. 批量改变样式，将设置样式的操作放在一起
   2. 批量修改DOM的优化方案
      1. 如果是向文档中加入大量dom结构，建议使用createDocumentFragment()，然后一次性加入文档
      2. 如果是像某一dom进行大量操作，可以先将其脱离文档流，例如设置成display:none，然后进行操作，再把display属性改回来
   3. 慎用hover属性，大量hover会降低速度
   4. 通过事件冒泡来实现时间委托，减少时间处理器的数量

# 四、算法和流程控制
1. 循环中减少属性查找和反转
2. 使用duff装置来优化循环
3. 通常情况下switch比if-else快，但不是最佳方案

# 五、快速响应的用户界面
1. 在windows系统中定时器分辨率为15毫秒，因此设置小于15毫秒将会使IE锁定，延时的最小值建议为25ms.
2. 用延时数组分割耗时任务：
3. 使用Web Worker：它引入了一个接口，能使代码运行且不占用浏览器UI线程的时间。一个Worker由如下部分组成：
   1. ① 一个navigator对象，包括appName,appVersion,user Agent和platform.
   2. ② 一个location对象，只读。
   3. ③ 一个self对象，指向全局worker对象
   4. ④ 一个importScripts()方法，用来加载worker所用到的外部js文件
   5. ⑤ 所有的ECMAScript对象。如object,Array,Date等
   6. ⑥ XMLHttpRequest构造器⑦ setTimeout()，setInterval()
   7. ⑧ 一个close()方法，它能立刻停止worker运行
   8. 应用场景：编码/解码大字符串、复杂数学运算（包括图像，视屏处理）、大数组排序
```js
// worker.js
var worker = new Worker('code.js');
// 接收信息
worker.onmessage = function(event){
    console.log(event.data);
}
// 发送数据
worker.postMessage('hello');

// code.js

// 导入其他计算代码
importScripts('a.js','b.js');

self.onmessage = function(event){
    self.postMessage('hello' + event.data);
}
```

# 六、网络优化
1. web客户端可以通过http请求中的Accept-Encoding头来表示对压缩的支持，压缩能将响应的数据量减少将近70%，因此可考虑对html,脚本，样式，图片进行压缩

```bash
// 浏览器请求时对http header设置
Accept-Encoding: gzip
// Web服务器响应时对http header设置
Content-Encoding: gzip
```